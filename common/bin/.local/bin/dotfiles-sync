#!/bin/bash

set -euo pipefail

readonly DOTFILES_BASE=$(realpath "$(dirname "$(realpath "$0")")"/../../../../)

pull=false
while getopts 'p' flag; do
  # shellcheck disable=SC2210
  case "${flag}" in
    p) pull=true ;;
    *) exit 1 ;;
  esac
done

for dir in common local; do
  dir="${DOTFILES_BASE}/${dir}"
  if [[ -d "${dir}" ]]; then
    # shellcheck disable=SC2035
    (cd "${dir}" && [[ "${pull}" == true ]] && git pull; stow --restow */)
  fi
done
