# SPDX-FileCopyrightText: 2019 Emil Lundmark <emil@lndmrk.se>
# SPDX-License-Identifier: GPL-3.0-or-later
---
- name: git sync
  shell: |
    set -e
    readonly before=$(git rev-parse HEAD)
    git pull --rebase
    readonly after=$(git rev-parse HEAD)
    [ "${before}" != "${after}" ] && exit 3
    exit 0
  args:
    chdir: "{{ path | default() }}"
  register: cmd
  changed_when: cmd.rc == 3
  failed_when: cmd.rc not in (0, 3)
  tags: sync
